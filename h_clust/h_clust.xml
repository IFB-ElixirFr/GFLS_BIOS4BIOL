<!--# Copyright (C) 2014 INRA
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see http://www.gnu.org/licenses/.
#-->
<tool id="h_clust" name="Hierarchical clustering">
    <requirements>
        <requirement type="package">R</requirement>
        <requirement type="package">r-rcolorbrewer</requirement>
        <requirement type="package">r-batch</requirement>
    </requirements>
    <description>(documentation available)</description>
    <command interpreter="Rscript">
    h_clust_galaxy.R
    input_file "$input_file"
    #if $conditional.selector =="YES":
          group_member_file "$conditional.group_member_file"
    #else
          group_member_file "$conditional.selector"
    #end if
    output_file "$output_file"
    log_file "$log_file"
    distance_method "$distance_method"
    agglomeration_method "$agglomeration_method"
    column_clustering "$sample_clustering"
    select "$select"
    plot_title "$plot_title"
    xlab "$xlab"
    ylab "$ylab"  
    #if $moreoption.more =="YES":
         width "$moreoption.width"
         height "$moreoption.height"
         ppi "$moreoption.ppi"
    #end if
    #if $moreoption.more =="NO":
         width "7"
         height "7"
         ppi "300"
    #end if
    na_encoding "$NA_code"
    </command>
    <inputs>                  
        <param format="csv, txt" name="input_file" type="data" label="Data file on which clustering will be performed"/>
        <conditional name="conditional">
            <param name="selector" type="select" label="Do you have an input variable/individual group member file ?">
                <option value="NO">No</option>
                <option value="YES">Yes</option>
            </param>
            <when value="YES">
                <param format="csv, txt" name="group_member_file" type="data" label="Input variable/individual group member file"/>  <!-- optionnal -->
            </when>
            <when value="NO" />
        </conditional>                     
        <param name="distance_method" type="select" label="The distance measure to be used (one choice mandatory)">
            <option value="euclidean">euclidean</option>
            <option value="correlation">correlation</option>
            <option value="maximum">maximum</option>
            <validator type="empty_field" message="Please choose, at least, one distance measure to be used." />
        </param>
        <param name="agglomeration_method" type="select" label="The agglomeration method to be used (one choice mandatory)">
            <option value="ward">ward</option>
            <option value="single">single</option>
            <option value="complete">complete</option>
            <option value="average">average</option>
            <validator type="empty_field" message="Please choose, at least, one agglomeration method to be used." />
        </param>
        <param name="sample_clustering" type="select" label="Clustering is performed on the columns">
            <option value="TRUE">Yes</option> <!-- member.csv -->
            <option value="FALSE">No</option>
        </param> 
        <param name="select" size="20" type="text" value="NULL"  label="Number of top elements to use for clustering, selected by highest row variance. If NULL all the elements will be used" />
        <param name="NA_code" size="30" type="text" value="NA" label="Label used for Missing values"/>
        <param name="plot_title" size="20" type="text" value="Title"  label="An overall title for the plot" />
        <param name="xlab" size="20" type="text" value="x axis"  label="A title for the x axis" /> 
        <param name="ylab" size="20" type="text" value="y axis"  label="A title for the y axis" />
        <conditional name="moreoption">
            <param name="more" type="select" label="Would you like to parameter more  graphic option">
                <option value="NO">No</option>
                <option value="YES">Yes</option>
            </param>
            <when value="YES">
                <param name="width" size="20" type="integer" value="7"  label="The width of the graphics region in inches" />
                <param name="height" size="20" type="integer" value="7"  label="The height of the graphics region in inches" />
                <param name="ppi" size="20" type="integer" value="300"  label="The nominal resolution in ppi" />
            </when>
            <when value="NO" />
        </conditional> 
        </inputs>
        <outputs>
            <data name="log_file" format="html" label="Hierarchical_clustering.log"/>
            <data name="output_file" format="html" label ="Hierarchical_clustering.report"/> 
        </outputs>
    <help>

.. class:: infomark

What it does :  This function allows to generate hierarchical cluster analysis on a numeric data table according to different parameters. 

It needs a dataset : the numeric data table and optionally a group member data to set colored labels. 
It generates a graphic tree from hierarchical clustering. 
 

.. image:: ./static/images/e_learning_book.png

Download documentation here :
http://genoweb.toulouse.inra.fr/~formation/CATIBIOS4BIOL_stats/Learning_clustering_current.pdf


Parameters :

Data file: Numeric data table file should be a txt or csv file with tabular as separator. Do you have an input variable/individual group member file ?: if YES the labels are colored. If NO the labels are not colored.

Input variable/individual group member file: Input variable/individual group member file should be a tabular file, with only one column which correspond to the condition, group you want to color in the hierarchical clustering. No title to the column (look at the example).
 
The distance measure to be used (one choice mandatory): This must be one of "euclidean", "correlation" or "maximum". The distance measure mostly used is "euclidean" and "correlation". 
The agglomeration method to be used (one choice mandatory): This should be one of "ward", "single", "complete" or "average". The distance measure mostly used is "ward".


Clustering is performed on the columns: if YES clustering is performed on the columns. if NO clustering is performed on the lines.

Number of top elements to use for clustering: Number of columns (or lines) to take into account for the clustering. The top elements will be selected by variance (top 10 elements with the biggest variance). If NULL all the elements will be used to perform clustering. For NGS or microarray data, this allows to perform a clustering on the top n most variables genes.

Label used for Missing values : Missing value coding characters

An overall title for the plot: enter a title for the plot

A title for the x axis: enter a title for the x axis

A title for the y axis: enter a title for the y axis

The width of the graphics region in inches: enter a number

The height of the graphics region in inches: enter a number

The nominal resolution in ppi: enter a number (a higher number means a high resolution which can take times to open)
       
---

Version Galaxy Tool : V1.0

---

Contacts (noms et emails) : sigenae-support@listes.inra.fr 

E-learning available : Not yet.

Please cite :
    
Depending on the help provided you can cite us in acknowledgements, references or both.
    
Examples :
Acknowledgements
We wish to thank SIGENAE group and the statistical CATI BIOS4Biol group : Ignacio Gonzalez, Sophie Lamarre, Sarah Maman, Luc Jouneau, Christophe Klopp
    
References
X. SIGENAE [http://www.sigenae.org/]
Love MI, Huber W and Anders S (2014). “Moderated estimation of fold change and dispersion for RNA-Seq data with DESeq2.”
bioRxiv. http://dx.doi.org/10.1101/002832, http://dx.doi.org/10.1101/002832.
    </help>
</tool>
